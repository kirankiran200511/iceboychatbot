<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ice-boy Chat Widget</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4ff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      text-align: center;
      background: white;
      border-radius: 20px;
      padding: 3rem 2.5rem;
      box-shadow: 0 8px 32px rgba(37,99,235,0.10);
      max-width: 420px;
      width: 90%;
    }
    .snowflake { font-size: 3rem; margin-bottom: 1rem; }
    h1 { font-size: 1.5rem; color: #1e293b; margin-bottom: 0.5rem; }
    p  { color: #64748b; font-size: 0.95rem; line-height: 1.6; }
    .arrow {
      margin-top: 2rem;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.5rem;
      color: #2563eb;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .arrow span { animation: bounce 1.2s infinite; }
    @keyframes bounce {
      0%,100% { transform: translateX(0); }
      50%      { transform: translateX(6px); }
    }
  </style>
</head>
<body>

  <div class="card">
    <div class="snowflake">ðŸ§Š</div>
    <h1>Ice-boy Support Chat</h1>
    <p>Click the blue button in the bottom-right corner to chat with our AI assistant.</p>
    <div class="arrow">Talk to us <span>â†’</span></div>
  </div>

  <script>
  (function () {
    'use strict';

    var WEBHOOK_URL = 'https://n8n.srv1178999.hstgr.cloud/webhook/680058b4-c36b-491f-b676-ebaeddbf7026/chat';
    var BOT_NAME    = 'Ice-boy Support';
    var BOT_SUB     = 'AI Assistant \u2022 33+ Years of Excellence';
    var WELCOME_1   = 'Hello! Welcome to Ice-boy India \uD83E\uDDCA';
    var WELCOME_2   = 'How can I help you today?';
    var POWERED_BY  = 'Powered by Ice-boy AI Assistant';
    var COLOR       = '#2563eb';

    /* â”€â”€ Inject CSS â”€â”€ */
    var s = document.createElement('style');
    s.textContent =
      '#ib-wrap{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;align-items:flex-end;gap:12px;z-index:2147483647;font-family:\'Segoe UI\',-apple-system,BlinkMacSystemFont,Roboto,sans-serif}' +
      '#ib-win{display:none;width:370px;height:520px;border-radius:16px;background:#fff;box-shadow:0 20px 60px rgba(0,0,0,.18),0 4px 16px rgba(37,99,235,.12);flex-direction:column;overflow:hidden;animation:ibSlide .22s cubic-bezier(.34,1.36,.64,1)}' +
      '#ib-win.open{display:flex}' +
      '@keyframes ibSlide{from{opacity:0;transform:scale(.92) translateY(16px)}to{opacity:1;transform:scale(1) translateY(0)}}' +
      '#ib-hdr{background:' + COLOR + ';padding:1rem 1.25rem;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}' +
      '#ib-hdr-l{display:flex;align-items:center;gap:10px}' +
      '#ib-av{width:38px;height:38px;border-radius:50%;background:rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center}' +
      '#ib-name{color:#fff;font-size:1rem;font-weight:600}' +
      '#ib-sub{color:rgba(255,255,255,.72);font-size:.72rem;margin-top:1px}' +
      '#ib-hdr-r{display:flex;align-items:center;gap:4px}' +
      '.ib-hbtn{background:transparent;border:none;cursor:pointer;color:rgba(255,255,255,.85);width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;transition:background .15s}' +
      '.ib-hbtn:hover{background:rgba(255,255,255,.18);color:#fff}' +
      '#ib-body{flex:1;overflow-y:auto;padding:1.1rem;background:#f9fafb;display:flex;flex-direction:column;scroll-behavior:smooth}' +
      '#ib-body::-webkit-scrollbar{width:3px}' +
      '#ib-body::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}' +
      '.ib-row{display:flex;align-items:flex-end;gap:7px;margin-bottom:.55rem;animation:ibMsg .2s ease both}' +
      '@keyframes ibMsg{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}' +
      '.ib-bot{justify-content:flex-start}.ib-usr{justify-content:flex-end}' +
      '.ib-mav{width:26px;height:26px;border-radius:50%;background:' + COLOR + ';display:flex;align-items:center;justify-content:center;flex-shrink:0}' +
      '.ib-col{display:flex;flex-direction:column;max-width:80%}' +
      '.ib-bot .ib-col{align-items:flex-start}.ib-usr .ib-col{align-items:flex-end}' +
      '.ib-bub{padding:.7rem .875rem;border-radius:12px;font-size:.9rem;line-height:1.55;word-break:break-word}' +
      '.ib-bot .ib-bub{background:#fff;color:#374151;border:1px solid #e5e7eb;border-bottom-left-radius:3px;white-space:pre-wrap}' +
      '.ib-bot .ib-bub a{color:' + COLOR + ';text-decoration:underline}' +
      '.ib-usr .ib-bub{background:' + COLOR + ';color:#fff;border-bottom-right-radius:3px}' +
      '.ib-typ{background:#fff;border:1px solid #e5e7eb;padding:.75rem .875rem;border-radius:12px;border-bottom-left-radius:3px;display:flex;gap:4px}' +
      '.ib-dot{width:6px;height:6px;border-radius:50%;background:#6b7280;animation:ibBnc 1.1s infinite ease-in-out}' +
      '.ib-dot:nth-child(2){animation-delay:.18s}.ib-dot:nth-child(3){animation-delay:.36s}' +
      '@keyframes ibBnc{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}' +
      '#ib-ftr{background:#fff;padding:.65rem .875rem .8rem;border-top:1px solid #f0f0f0;flex-shrink:0}' +
      '#ib-credit{text-align:center;font-size:.65rem;color:#9ca3af;margin-bottom:.45rem}' +
      '#ib-iw{display:flex;align-items:flex-end;gap:6px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:999px;padding:.4rem .55rem;transition:border-color .15s}' +
      '#ib-iw:focus-within{border-color:' + COLOR + '}' +
      '#ib-inp{flex:1;border:none;background:transparent;font-size:.9rem;font-family:inherit;color:#374151;outline:none;resize:none;min-height:20px;max-height:100px;line-height:1.5;padding:2px 0}' +
      '#ib-inp::placeholder{color:#9ca3af}' +
      '#ib-send{background:' + COLOR + ';border:none;cursor:pointer;color:#fff;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}' +
      '#ib-send:hover{background:#1d4ed8}#ib-send:active{transform:scale(.92)}#ib-send:disabled{background:#93c5fd;cursor:not-allowed}' +
      '#ib-btn{width:60px;height:60px;border-radius:50%;background:' + COLOR + ';border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 28px rgba(37,99,235,.5);transition:background .15s,transform .15s;flex-shrink:0}' +
      '#ib-btn:hover{background:#1d4ed8;transform:scale(1.06)}#ib-btn:active{transform:scale(.97)}' +
      '#ib-ico-x{display:none}' +
      '@media(max-width:480px){#ib-win{width:100vw;height:100dvh;border-radius:0;position:fixed;bottom:0;right:0}}';
    document.head.appendChild(s);

    /* â”€â”€ SVGs â”€â”€ */
    function flake(sz) {
      return '<svg xmlns="http://www.w3.org/2000/svg" width="'+sz+'" height="'+sz+'" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">' +
        '<line x1="12" y1="2" x2="12" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/>' +
        '<line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/><line x1="19.07" y1="4.93" x2="4.93" y2="19.07"/>' +
        '<line x1="12" y1="2" x2="9" y2="5"/><line x1="12" y1="2" x2="15" y2="5"/>' +
        '<line x1="12" y1="22" x2="9" y2="19"/><line x1="12" y1="22" x2="15" y2="19"/>' +
        '<line x1="2" y1="12" x2="5" y2="9"/><line x1="2" y1="12" x2="5" y2="15"/>' +
        '<line x1="22" y1="12" x2="19" y2="9"/><line x1="22" y1="12" x2="19" y2="15"/></svg>';
    }
    var REFRESH_SVG = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>';
    var CLOSE_SVG   = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
    var CLOSE_W_SVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
    var SEND_SVG    = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>';

    /* â”€â”€ Inject HTML â”€â”€ */
    var wrap = document.createElement('div');
    wrap.id = 'ib-wrap';
    wrap.innerHTML =
      '<div id="ib-win" role="dialog">' +
        '<div id="ib-hdr">' +
          '<div id="ib-hdr-l"><div id="ib-av">' + flake(18) + '</div>' +
          '<div><div id="ib-name">' + BOT_NAME + '</div><div id="ib-sub">' + BOT_SUB + '</div></div></div>' +
          '<div id="ib-hdr-r">' +
            '<button class="ib-hbtn" id="ib-refresh" title="Clear chat">' + REFRESH_SVG + '</button>' +
            '<button class="ib-hbtn" id="ib-x" title="Close">' + CLOSE_SVG + '</button>' +
          '</div>' +
        '</div>' +
        '<div id="ib-body"></div>' +
        '<div id="ib-ftr"><div id="ib-credit">' + POWERED_BY + '</div>' +
          '<div id="ib-iw"><textarea id="ib-inp" rows="1" placeholder="Type your message\u2026"></textarea>' +
          '<button id="ib-send">' + SEND_SVG + '</button></div>' +
        '</div>' +
      '</div>' +
      '<button id="ib-btn" aria-label="Open chat">' +
        '<span id="ib-ico-flake">' + flake(26) + '</span>' +
        '<span id="ib-ico-x">' + CLOSE_W_SVG + '</span>' +
      '</button>';
    document.body.appendChild(wrap);

    /* â”€â”€ State & refs â”€â”€ */
    var isOpen = false, welcomed = false, isTyping = false;
    var sessionId = mkSession();
    var win = document.getElementById('ib-win');
    var bod = document.getElementById('ib-body');
    var inp = document.getElementById('ib-inp');
    var snd = document.getElementById('ib-send');
    var icoF = document.getElementById('ib-ico-flake');
    var icoX = document.getElementById('ib-ico-x');

    document.getElementById('ib-btn').addEventListener('click', function(){ isOpen ? close() : open(); });
    document.getElementById('ib-x').addEventListener('click', close);
    document.getElementById('ib-refresh').addEventListener('click', clearChat);
    snd.addEventListener('click', send);
    inp.addEventListener('keydown', function(e){ if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();} });
    inp.addEventListener('input', function(){ this.style.height='auto'; this.style.height=Math.min(this.scrollHeight,100)+'px'; });

    function open() {
      isOpen = true;
      win.classList.add('open');
      icoF.style.display = 'none';
      icoX.style.display = 'inline';
      inp.focus(); scrollBottom();
      if (!welcomed) showWelcome();
    }

    function close() {
      isOpen = false;
      win.classList.remove('open');
      icoF.style.display = 'inline';
      icoX.style.display = 'none';
    }

    function clearChat() {
      bod.innerHTML = '';
      sessionId = mkSession();
      welcomed = false;
      showWelcome();
    }

    function showWelcome() {
      welcomed = true;
      setTimeout(function(){ addMsg('bot', WELCOME_1); }, 300);
      setTimeout(function(){ addMsg('bot', WELCOME_2); }, 900);
    }

    async function send() {
      var text = inp.value.trim();
      if (!text || isTyping) return;
      addMsg('user', text);
      inp.value = ''; inp.style.height = 'auto';
      snd.disabled = true; isTyping = true; showTyping();
      try {
        var res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chatInput: text, sessionId: sessionId })
        });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        var data = await res.json(); hideTyping();
        var reply = typeof data==='string' ? data
          : Array.isArray(data) ? (data[0]?.output||data[0]?.text||data[0]?.message||'')
          : (data?.output||data?.text||data?.message||data?.reply||data?.response||'');
        addMsg('bot', reply || 'Message received!');
      } catch(e) {
        hideTyping();
        addMsg('bot', 'Sorry, I could not reach the server. Please try again.');
      } finally { snd.disabled = false; isTyping = false; }
    }

    function addMsg(role, text) {
      var row = document.createElement('div');
      row.className = 'ib-row ' + (role==='bot' ? 'ib-bot' : 'ib-usr');
      var c = role==='bot' ? fmtBot(text) : esc(text);
      row.innerHTML = role==='bot'
        ? '<div class="ib-mav">'+flake(12)+'</div><div class="ib-col"><div class="ib-bub">'+c+'</div></div>'
        : '<div class="ib-col"><div class="ib-bub">'+c+'</div></div>';
      bod.appendChild(row); scrollBottom();
    }

    function showTyping() {
      var r = document.createElement('div');
      r.className='ib-row ib-bot'; r.id='ib-typ';
      r.innerHTML='<div class="ib-mav">'+flake(12)+'</div><div class="ib-typ"><div class="ib-dot"></div><div class="ib-dot"></div><div class="ib-dot"></div></div>';
      bod.appendChild(r); scrollBottom();
    }

    function hideTyping() { var e=document.getElementById('ib-typ'); if(e) e.remove(); }
    function scrollBottom() { requestAnimationFrame(function(){ bod.scrollTop=bod.scrollHeight; }); }
    function mkSession() {
      var k='iceboy_s', id; try{ id=localStorage.getItem(k); }catch(e){}
      if(!id){ id='sess_'+Math.random().toString(36).slice(2)+Date.now().toString(36); try{localStorage.setItem(k,id);}catch(e){} }
      return id;
    }
    function esc(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
    function fmtBot(text) {
      var links=[], out=text.replace(/\[([^\]]+)\]\((https?:\/\/[^)]+)\)/g,function(_,lt,url){ links.push({text:lt,url:url}); return '###L'+(links.length-1)+'###'; });
      out=esc(out);
      links.forEach(function(l,i){ out=out.replace('###L'+i+'###','<a href="'+l.url.replace(/"/g,'&quot;')+'" target="_blank" rel="noopener">'+esc(l.text)+'</a>'); });
      return out;
    }

  })();
  </script>

</body>
</html>
