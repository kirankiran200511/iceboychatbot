<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ice-boy Chat Widget</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: transparent; min-height: 100vh; }
  </style>
</head>
<body>
  <script>
  (function () {
    'use strict';
    var WEBHOOK_URL = 'https://n8n.srv1178999.hstgr.cloud/webhook/680058b4-c36b-491f-b676-ebaeddbf7026/chat';
    var BOT_NAME = 'Ice-boy Support';
    var BOT_SUB  = 'AI Assistant \u2022 33+ Years of Excellence';
    var W1 = 'Hello! Welcome to Ice-boy India \uD83E\uDDCA';
    var W2 = 'How can I help you today?';
    var PB = 'Powered by Ice-boy AI Assistant';
    var C  = '#2563eb';

    var s = document.createElement('style');
    s.textContent =
      '#ibw{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;align-items:flex-end;gap:12px;z-index:2147483647;font-family:"Segoe UI",-apple-system,BlinkMacSystemFont,Roboto,sans-serif}'+
      '#ibwin{display:none;width:370px;height:520px;border-radius:16px;background:#fff;box-shadow:0 20px 60px rgba(0,0,0,.18),0 4px 16px rgba(37,99,235,.12);flex-direction:column;overflow:hidden;animation:ibs .22s cubic-bezier(.34,1.36,.64,1)}'+
      '#ibwin.open{display:flex}'+
      '@keyframes ibs{from{opacity:0;transform:scale(.92) translateY(16px)}to{opacity:1;transform:scale(1) translateY(0)}}'+
      '#ibh{background:'+C+';padding:1rem 1.25rem;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}'+
      '#ibhl{display:flex;align-items:center;gap:10px}'+
      '#ibav{width:38px;height:38px;border-radius:50%;background:rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center}'+
      '#ibnm{color:#fff;font-size:1rem;font-weight:600}'+
      '#ibsb{color:rgba(255,255,255,.72);font-size:.72rem;margin-top:1px}'+
      '#ibhr{display:flex;align-items:center;gap:4px}'+
      '.ibhb{background:transparent;border:none;cursor:pointer;color:rgba(255,255,255,.85);width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;transition:background .15s}'+
      '.ibhb:hover{background:rgba(255,255,255,.18);color:#fff}'+
      '#ibbd{flex:1;overflow-y:auto;padding:1.1rem;background:#f9fafb;display:flex;flex-direction:column;scroll-behavior:smooth}'+
      '#ibbd::-webkit-scrollbar{width:3px}#ibbd::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}'+
      '.ibr{display:flex;align-items:flex-end;gap:7px;margin-bottom:.55rem;animation:ibm .2s ease both}'+
      '@keyframes ibm{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}'+
      '.ibot{justify-content:flex-start}.ibusr{justify-content:flex-end}'+
      '.ibav{width:26px;height:26px;border-radius:50%;background:'+C+';display:flex;align-items:center;justify-content:center;flex-shrink:0}'+
      '.ibcl{display:flex;flex-direction:column;max-width:80%}'+
      '.ibot .ibcl{align-items:flex-start}.ibusr .ibcl{align-items:flex-end}'+
      '.ibbl{padding:.7rem .875rem;border-radius:12px;font-size:.9rem;line-height:1.55;word-break:break-word}'+
      '.ibot .ibbl{background:#fff;color:#374151;border:1px solid #e5e7eb;border-bottom-left-radius:3px;white-space:pre-wrap}'+
      '.ibot .ibbl a{color:'+C+';text-decoration:underline}'+
      '.ibusr .ibbl{background:'+C+';color:#fff;border-bottom-right-radius:3px}'+
      '.ibtp{background:#fff;border:1px solid #e5e7eb;padding:.75rem .875rem;border-radius:12px;border-bottom-left-radius:3px;display:flex;gap:4px}'+
      '.ibdt{width:6px;height:6px;border-radius:50%;background:#6b7280;animation:ibbc 1.1s infinite ease-in-out}'+
      '.ibdt:nth-child(2){animation-delay:.18s}.ibdt:nth-child(3){animation-delay:.36s}'+
      '@keyframes ibbc{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}'+
      '#ibft{background:#fff;padding:.65rem .875rem .8rem;border-top:1px solid #f0f0f0;flex-shrink:0}'+
      '#ibcr{text-align:center;font-size:.65rem;color:#9ca3af;margin-bottom:.45rem}'+
      '#ibiw{display:flex;align-items:flex-end;gap:6px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:999px;padding:.4rem .55rem;transition:border-color .15s}'+
      '#ibiw:focus-within{border-color:'+C+'}'+
      '#ibinp{flex:1;border:none;background:transparent;font-size:.9rem;font-family:inherit;color:#374151;outline:none;resize:none;min-height:20px;max-height:100px;line-height:1.5;padding:2px 0}'+
      '#ibinp::placeholder{color:#9ca3af}'+
      '#ibsnd{background:'+C+';border:none;cursor:pointer;color:#fff;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}'+
      '#ibsnd:hover{background:#1d4ed8}#ibsnd:active{transform:scale(.92)}#ibsnd:disabled{background:#93c5fd;cursor:not-allowed}'+
      '#ibbtn{width:60px;height:60px;border-radius:50%;background:'+C+';border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 28px rgba(37,99,235,.5);transition:background .15s,transform .15s;flex-shrink:0}'+
      '#ibbtn:hover{background:#1d4ed8;transform:scale(1.06)}#ibbtn:active{transform:scale(.97)}'+
      '@media(max-width:480px){#ibwin{width:100vw;height:100dvh;border-radius:0;position:fixed;bottom:0;right:0}}';
    document.head.appendChild(s);

    function fl(sz){
      return '<svg xmlns="http://www.w3.org/2000/svg" width="'+sz+'" height="'+sz+'" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><line x1="12" y1="2" x2="12" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/><line x1="19.07" y1="4.93" x2="4.93" y2="19.07"/><line x1="12" y1="2" x2="9" y2="5"/><line x1="12" y1="2" x2="15" y2="5"/><line x1="12" y1="22" x2="9" y2="19"/><line x1="12" y1="22" x2="15" y2="19"/><line x1="2" y1="12" x2="5" y2="9"/><line x1="2" y1="12" x2="5" y2="15"/><line x1="22" y1="12" x2="19" y2="9"/><line x1="22" y1="12" x2="19" y2="15"/></svg>';
    }
    var RF='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>';
    var CL='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
    var SN='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>';

    var wrap=document.createElement('div'); wrap.id='ibw';
    wrap.innerHTML=
      '<div id="ibwin" role="dialog">'+
        '<div id="ibh"><div id="ibhl"><div id="ibav">'+fl(18)+'</div>'+
        '<div><div id="ibnm">'+BOT_NAME+'</div><div id="ibsb">'+BOT_SUB+'</div></div></div>'+
        '<div id="ibhr"><button class="ibhb" id="ibrf" title="Clear chat">'+RF+'</button>'+
        '<button class="ibhb" id="ibcl" title="Close">'+CL+'</button></div></div>'+
        '<div id="ibbd"></div>'+
        '<div id="ibft"><div id="ibcr">'+PB+'</div>'+
        '<div id="ibiw"><textarea id="ibinp" rows="1" placeholder="Type your message\u2026"></textarea>'+
        '<button id="ibsnd">'+SN+'</button></div></div>'+
      '</div>'+
      '<button id="ibbtn" aria-label="Open chat">'+fl(26)+'</button>';
    document.body.appendChild(wrap);

    var isOpen=false,welcomed=false,isTyping=false;
    var sid=mkSid();
    var win=document.getElementById('ibwin');
    var bod=document.getElementById('ibbd');
    var inp=document.getElementById('ibinp');
    var snd=document.getElementById('ibsnd');
    var btn=document.getElementById('ibbtn');

    btn.addEventListener('click',function(){isOpen?close():open();});
    document.getElementById('ibcl').addEventListener('click',close);
    document.getElementById('ibrf').addEventListener('click',clearChat);
    snd.addEventListener('click',send);
    inp.addEventListener('keydown',function(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}});
    inp.addEventListener('input',function(){this.style.height='auto';this.style.height=Math.min(this.scrollHeight,100)+'px';});

    function open(){
      isOpen=true;
      win.classList.add('open');
      btn.style.display='none';   /* ← hide toggle button so it doesn't cover input */
      inp.focus();scrollBottom();
      if(!welcomed)showWelcome();
    }
    function close(){
      isOpen=false;
      win.classList.remove('open');
      btn.style.display='flex';   /* ← show toggle button again */
    }
    function clearChat(){
      bod.innerHTML='';
      sid=mkSid();
      welcomed=false;
      showWelcome();
    }
    function showWelcome(){
      welcomed=true;
      setTimeout(function(){addMsg('bot',W1);},300);
      setTimeout(function(){addMsg('bot',W2);},900);
    }
    async function send(){
      var t=inp.value.trim();if(!t||isTyping)return;
      addMsg('user',t);inp.value='';inp.style.height='auto';
      snd.disabled=true;isTyping=true;showTyping();
      try{
        var r=await fetch(WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chatInput:t,sessionId:sid})});
        if(!r.ok)throw new Error('HTTP '+r.status);
        var d=await r.json();hideTyping();
        var rep=typeof d==='string'?d:Array.isArray(d)?(d[0]?.output||d[0]?.text||d[0]?.message||''):(d?.output||d?.text||d?.message||d?.reply||d?.response||'');
        addMsg('bot',rep||'Message received!');
      }catch(e){hideTyping();addMsg('bot','Sorry, I could not reach the server. Please try again.');}
      finally{snd.disabled=false;isTyping=false;}
    }
    function addMsg(role,text){
      var row=document.createElement('div');row.className='ibr '+(role==='bot'?'ibot':'ibusr');
      var c=role==='bot'?fmtBot(text):esc(text);
      row.innerHTML=role==='bot'?'<div class="ibav">'+fl(12)+'</div><div class="ibcl"><div class="ibbl">'+c+'</div></div>':'<div class="ibcl"><div class="ibbl">'+c+'</div></div>';
      bod.appendChild(row);scrollBottom();
    }
    function showTyping(){
      var r=document.createElement('div');r.className='ibr ibot';r.id='ibtyp';
      r.innerHTML='<div class="ibav">'+fl(12)+'</div><div class="ibtp"><div class="ibdt"></div><div class="ibdt"></div><div class="ibdt"></div></div>';
      bod.appendChild(r);scrollBottom();
    }
    function hideTyping(){var e=document.getElementById('ibtyp');if(e)e.remove();}
    function scrollBottom(){requestAnimationFrame(function(){bod.scrollTop=bod.scrollHeight;});}
    function mkSid(){var k='ib_s',id;try{id=localStorage.getItem(k);}catch(e){}if(!id){id='s_'+Math.random().toString(36).slice(2)+Date.now().toString(36);try{localStorage.setItem(k,id);}catch(e){}}return id;}
    function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
    function fmtBot(t){var l=[],o=t.replace(/\[([^\]]+)\]\((https?:\/\/[^)]+)\)/g,function(_,lt,u){l.push({text:lt,url:u});return '###L'+(l.length-1)+'###';});o=esc(o);l.forEach(function(lk,i){o=o.replace('###L'+i+'###','<a href="'+lk.url.replace(/"/g,'&quot;')+'" target="_blank" rel="noopener">'+esc(lk.text)+'</a>');});return o;}
  })();
  </script>
</body>
</html>
